<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Stazka Pro - Mobiln√≠ verze</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Stazka Pro">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiByeD0iNDAiIGZpbGw9IiM2NjdlZWEiLz4KPHN2ZyB4PSI0MCIgeT0iNDAiIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IndoaXRlIj4KICA8cGF0aCBkPSJNMjAuMzggNmgtMi44NGwtMS41NC0xLjNWMi4yMWEyIDIgMCAwIDAtMi0yek0xNSAwSDJhMiAyIDAgMCAwLTIgMnYxOGEyIDIgMCAwIDAgMiAyaDYuMkwxNSAxOFoiLz4KICA8cGF0aCBkPSJNMjIgOHYxMmEyIDIgMCAwIDEtMiAyaC00bC0zIDJoN2EyIDIgMCAwIDAgMi0yVjhIMjJaIi8+Cjwvc3ZnPgo8L3N2Zz4=">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        .mobile-header {
            background: rgba(30, 60, 114, 0.95);
            color: white;
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0,0,0,0.2);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            font-size: 1.4em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .truck-icon {
            font-size: 1.8em;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }

        .status-badge {
            background: #27ae60;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .main-container {
            padding: 0;
            max-width: 100%;
        }

        .section-card {
            background: white;
            margin: 15px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        .section-card:active {
            transform: translateY(2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        .section-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            font-weight: bold;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-content {
            padding: 20px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group:last-child {
            margin-bottom: 0;
        }

        .input-label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            border: 2px solid #e8f4fd;
            border-radius: 12px;
            font-size: 16px;
            background: #fafbfc;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .map-container {
            background: white;
            margin: 15px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .map-header {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .map-title {
            font-weight: bold;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .gps-status {
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        #map {
            height: 300px;
            width: 100%;
        }

        .location-info {
            padding: 20px;
            background: #f8f9fa;
        }

        .location-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .location-label {
            color: #666;
            font-weight: 500;
        }

        .location-value {
            color: #2c3e50;
            font-weight: bold;
        }

        .floating-speed {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            backdrop-filter: blur(10px);
            z-index: 999;
        }

        .speed-value {
            font-size: 1.2em;
            line-height: 1;
        }

        .speed-unit {
            font-size: 0.7em;
            opacity: 0.8;
        }

        .trip-status {
            background: rgba(39, 174, 96, 0.1);
            border: 1px solid rgba(39, 174, 96, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin: 15px;
            display: none;
        }

        .trip-status.active {
            display: block;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .status-item {
            text-align: center;
            background: rgba(255,255,255,0.5);
            padding: 15px;
            border-radius: 10px;
        }

        .status-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #27ae60;
            display: block;
        }

        .status-label {
            color: #666;
            font-size: 0.8em;
            margin-top: 5px;
        }

        .saved-trips {
            background: white;
            margin: 15px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .saved-trips-header {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            font-weight: bold;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .trip-item {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
        }

        .trip-item:hover {
            background: #f8f9fa;
        }

        .trip-item:last-child {
            border-bottom: none;
        }

        .trip-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .trip-details {
            flex: 1;
        }

        .trip-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .trip-meta {
            color: #666;
            font-size: 0.9em;
        }

        .trip-status-badge {
            background: #e74c3c;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
        }

        .trip-status-badge.active {
            background: #27ae60;
        }

        .action-buttons {
            position: fixed;
            bottom: 20px;
            left: 15px;
            right: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            z-index: 1000;
        }

        .btn-mobile {
            padding: 18px 25px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:active {
            transform: translateY(2px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .btn-secondary:active {
            transform: translateY(2px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-warning:active {
            transform: translateY(2px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-danger:active {
            transform: translateY(2px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .select-field {
            width: 100%;
            padding: 15px;
            border: 2px solid #e8f4fd;
            border-radius: 12px;
            font-size: 16px;
            background: #fafbfc;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        .select-field:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .bottom-spacer {
            height: 100px;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 360px) {
            .section-card {
                margin: 10px;
                border-radius: 15px;
            }
            
            .section-content {
                padding: 15px;
            }
            
            .input-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="mobile-header">
        <div class="header-content">
            <div class="app-title">
                <span class="truck-icon">üöõ</span>
                Stazka Pro
            </div>
            <div class="status-badge">
                <span class="status-dot"></span>
                <span id="headerStatus">Offline</span>
            </div>
        </div>
    </div>

    <div class="floating-speed" id="speedometer">
        <div class="speed-value" id="currentSpeed">0</div>
        <div class="speed-unit">km/h</div>
    </div>

    <div class="main-container">
        <!-- Ulo≈æen√© cesty -->
        <div class="saved-trips" id="savedTripsSection">
            <div class="saved-trips-header">
                <span>üìÇ</span>
                Ulo≈æen√© cesty
            </div>
            <div id="savedTripsContainer">
                <!-- Dynamicky generovan√© polo≈æky -->
            </div>
        </div>

        <!-- Formul√°≈ô pro novou cestu -->
        <div id="newTripForm">
            <form id="mobileLogbookForm">
                <!-- √ödaje o ≈ôidiƒçi -->
                <div class="section-card">
                    <div class="section-header">
                        <span>üë§</span>
                        √ödaje o ≈ôidiƒçi
                    </div>
                    <div class="section-content">
                        <div class="input-group">
                            <label class="input-label" for="driverName">Jm√©no a p≈ô√≠jmen√≠</label>
                            <input type="text" id="driverName" class="input-field" required>
                        </div>
                        <div class="input-group">
                            <label class="input-label" for="licenseNumber">ƒå√≠slo ≈ôidiƒçsk√©ho pr≈Økazu</label>
                            <input type="text" id="licenseNumber" class="input-field" required>
                        </div>
                        <div class="input-group">
                            <label class="input-label" for="employerName">Zamƒõstnavatel</label>
                            <input type="text" id="employerName" class="input-field" required>
                        </div>
                    </div>
                </div>

                <!-- √ödaje o vozidle -->
                <div class="section-card">
                    <div class="section-header">
                        <span>üöö</span>
                        Vozidlo
                    </div>
                    <div class="section-content">
                        <div class="input-row">
                            <div class="input-group">
                                <label class="input-label" for="vehiclePlate">SPZ vozidla</label>
                                <input type="text" id="vehiclePlate" class="input-field" required>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="odometerStart">Tachometr (km)</label>
                                <input type="number" id="odometerStart" class="input-field" required>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label" for="vehicleType">Typ vozidla</label>
                            <select id="vehicleType" class="select-field" required>
                                <option value="">Vyberte typ</option>
                                <option value="n√°kladn√≠">N√°kladn√≠ automobil</option>
                                <option value="autobus">Autobus</option>
                                <option value="souprava">N√°kladn√≠ souprava</option>
                                <option value="tahaƒç">Tahaƒç s n√°vƒõsem</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label" for="trailerPlate">SPZ p≈ô√≠vƒõsu (voliteln√©)</label>
                            <input type="text" id="trailerPlate" class="input-field">
                        </div>
                    </div>
                </div>

                <!-- Datum a ƒças -->
                <div class="section-card">
                    <div class="section-header">
                        <span>üìÖ</span>
                        Datum a ƒças
                    </div>
                    <div class="section-content">
                        <div class="input-row">
                            <div class="input-group">
                                <label class="input-label" for="workDate">Datum</label>
                                <input type="date" id="workDate" class="input-field" required>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="startTime">ƒåas zah√°jen√≠</label>
                                <input type="time" id="startTime" class="input-field" required>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trasa -->
                <div class="section-card">
                    <div class="section-header">
                        <span>üìç</span>
                        Trasa a n√°klad
                    </div>
                    <div class="section-content">
                        <div class="input-group">
                            <label class="input-label" for="startLocation">M√≠sto zah√°jen√≠</label>
                            <input type="text" id="startLocation" class="input-field" required>
                        </div>
                        <div class="input-group">
                            <label class="input-label" for="endLocation">C√≠lov√© m√≠sto</label>
                            <input type="text" id="endLocation" class="input-field">
                        </div>
                        <div class="input-group">
                            <label class="input-label" for="routeDescription">Popis n√°kladu/cesty</label>
                            <input type="text" id="routeDescription" class="input-field">
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Trip status -->
        <div class="trip-status" id="tripStatus">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                <div style="font-size: 2em;">üöõ</div>
                <div>
                    <div style="font-weight: bold; color: #27ae60; font-size: 1.2em;">J√≠zda prob√≠h√°</div>
                    <div style="color: #666; font-size: 0.9em;">Zah√°jeno: <span id="tripStartDisplay">---</span></div>
                </div>
            </div>
            <div class="status-grid">
                <div class="status-item">
                    <span class="status-value" id="tripDuration">00:00</span>
                    <div class="status-label">Doba j√≠zdy</div>
                </div>
                <div class="status-item">
                    <span class="status-value" id="tripDistance">0.0</span>
                    <div class="status-label">Km ujet√Ωch</div>
                </div>
                <div class="status-item">
                    <span class="status-value" id="routePoints">0</span>
                    <div class="status-label">GPS bod≈Ø</div>
                </div>
                <div class="status-item">
                    <span class="status-value" id="stopsCount">0</span>
                    <div class="status-label">Zast√°vek</div>
                </div>
            </div>
        </div>

        <!-- Mapa -->
        <div class="map-container">
            <div class="map-header">
                <div class="map-title">
                    <span>üó∫Ô∏è</span>
                    <span id="mapTitle">Aktu√°ln√≠ poloha</span>
                </div>
                <div class="gps-status" id="gpsStatus">
                    <span>üì°</span>
                    Vyhled√°v√°n√≠...
                </div>
            </div>
            <div id="map"></div>
            <div class="location-info">
                <div class="location-row">
                    <span class="location-label">Zemƒõpisn√° ≈°√≠≈ôka:</span>
                    <span class="location-value" id="latitude">---</span>
                </div>
                <div class="location-row">
                    <span class="location-label">Zemƒõpisn√° d√©lka:</span>
                    <span class="location-value" id="longitude">---</span>
                </div>
                <div class="location-row">
                    <span class="location-label">P≈ôesnost GPS:</span>
                    <span class="location-value" id="accuracy">---</span>
                </div>
                <div class="location-row">
                    <span class="location-label">Posledn√≠ aktualizace:</span>
                    <span class="location-value" id="lastUpdate">---</span>
                </div>
            </div>
        </div>

        <div class="bottom-spacer"></div>
    </div>

    <div class="action-buttons">
        <button type="button" class="btn-mobile btn-secondary" onclick="clearForm()" id="clearBtn">
            <span>üóëÔ∏è</span>
            Vymazat
        </button>
        <button type="submit" form="mobileLogbookForm" class="btn-mobile btn-primary" id="startBtn">
            <span>üöÄ</span>
            Zah√°jit
        </button>
        <button type="button" class="btn-mobile btn-warning" onclick="addStop()" id="stopBtn" style="display: none;">
            <span>‚è∏Ô∏è</span>
            P≈ôidat zast√°vku
        </button>
        <button type="button" class="btn-mobile btn-danger" onclick="endTrip()" id="endBtn" style="display: none;">
            <span>üèÅ</span>
            Ukonƒçit j√≠zdu
        </button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script>
        // Glob√°ln√≠ promƒõnn√©
        let map, marker, watchId, routePolyline;
        let currentRoute = [];
        let isTracking = false;
        let tripData = {};
        let stops = [];
        let tripStartTime = null;
        let savedTrips = [];
        let currentTripId = null;
        let tripTimer = null;

        // Inicializace p≈ôi naƒçten√≠ str√°nky
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedTrips();
            initializeApp();
            initializeMap();
            requestLocationPermission();
            updateSavedTripsDisplay();
        });

        function initializeApp() {
            // Nastaven√≠ aktu√°ln√≠ho data a ƒçasu
            const now = new Date();
            document.getElementById('workDate').valueAsDate = now;
            
            const currentTime = now.getHours().toString().padStart(2, '0') + ':' + 
                               now.getMinutes().toString().padStart(2, '0');
            document.getElementById('startTime').value = currentTime;

            // Form√°tov√°n√≠ SPZ
            ['vehiclePlate', 'trailerPlate'].forEach(id => {
                document.getElementById(id).addEventListener('input', function(e) {
                    e.target.value = e.target.value.toUpperCase();
                });
            });
        }

        function initializeMap() {
            // Inicializace mapy (v√Ωchoz√≠ pozice Praha)
            map = L.map('map').setView([50.0755, 14.4378], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);

            // P≈ôid√°n√≠ ovl√°d√°n√≠
            L.control.scale().addTo(map);
        }

        function requestLocationPermission() {
            if ('geolocation' in navigator) {
                updateGPSStatus('Po≈æaduji opr√°vnƒõn√≠...', '#ff9800');
                
                const options = {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                };

                watchId = navigator.geolocation.watchPosition(
                    onLocationSuccess,
                    onLocationError,
                    options
                );
            } else {
                updateGPSStatus('GPS nepodporov√°no', '#f44336');
            }
        }

        function onLocationSuccess(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const accuracy = position.coords.accuracy;
            const speed = position.coords.speed || 0;

            updateGPSStatus('GPS p≈ôipojeno', '#4caf50');
            document.getElementById('headerStatus').textContent = 'Online';
            updateLocationInfo(lat, lng, accuracy);
            updateSpeedometer(speed);
            updateMapPosition(lat, lng, accuracy);
            
            // P≈ôid√°n√≠ bodu do trasy bƒõhem sledov√°n√≠
            if (isTracking) {
                addRoutePoint(lat, lng, speed, accuracy);
                updateTripStats();
                updateRouteOnMap();
            }
        }

        function onLocationError(error) {
            let message = 'Chyba GPS';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    message = 'Opr√°vnƒõn√≠ zam√≠tnuto';
                    break;
                case error.POSITION_UNAVAILABLE:
                    message = 'Poloha nedostupn√°';
                    break;
                case error.TIMEOUT:
                    message = 'ƒåasov√Ω limit';
                    break;
            }
            updateGPSStatus(message, '#f44336');
            document.getElementById('headerStatus').textContent = 'Offline';
        }

        function updateGPSStatus(text, color) {
            const statusElement = document.getElementById('gpsStatus');
            statusElement.innerHTML = `<span>üì°</span>${text}`;
            statusElement.style.background = color;
        }

        function updateLocationInfo(lat, lng, accuracy) {
            document.getElementById('latitude').textContent = lat.toFixed(6);
            document.getElementById('longitude').textContent = lng.toFixed(6);
            document.getElementById('accuracy').textContent = Math.round(accuracy) + ' m';
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('cs-CZ');
        }

        function updateSpeedometer(speed) {
            const speedKmh = speed ? Math.round(speed * 3.6) : 0;
            document.getElementById('currentSpeed').textContent = speedKmh;
            
            // Zmƒõna barvy podle rychlosti
            const speedometer = document.getElementById('speedometer');
            if (speedKmh > 50) {
                speedometer.style.background = 'rgba(255, 152, 0, 0.9)';
            } else if (speedKmh > 0) {
                speedometer.style.background = 'rgba(76, 175, 80, 0.9)';
            } else {
                speedometer.style.background = 'rgba(0, 0, 0, 0.8)';
            }
        }

        function updateMapPosition(lat, lng, accuracy) {
            // Aktualizace pozice markeru
            if (marker) {
                map.removeLayer(marker);
            }
            
            marker = L.marker([lat, lng]).addTo(map)
                .bindPopup(`üìç Aktu√°ln√≠ poloha<br>P≈ôesnost: ${Math.round(accuracy)}m`);
            
            // Kruhy p≈ôesnosti
            const accuracyCircle = L.circle([lat, lng], {
                radius: accuracy,
                fillColor: '#667eea',
                fillOpacity: 0.2,
                color: '#667eea',
                weight: 2
            }).addTo(map);
            
            // Centrov√°n√≠ mapy pouze p≈ôi prvn√≠m naƒçten√≠
            if (!map.hasBeenCentered) {
                map.setView([lat, lng], 15);
                map.hasBeenCentered = true;
            }
        }

        function addRoutePoint(lat, lng, speed, accuracy) {
            const routePoint = {
                lat: lat,
                lng: lng,
                timestamp: new Date(),
                speed: speed,
                accuracy: accuracy
            };
            currentRoute.push(routePoint);
            
            // Ulo≈æen√≠ do aktu√°ln√≠ cesty
            if (currentTripId) {
                saveCurrentTrip();
            }
        }

        function updateRouteOnMap() {
            // Odstra≈à star√Ω polyline
            if (routePolyline) {
                map.removeLayer(routePolyline);
            }
            
            // Vytvo≈ô nov√Ω polyline z trasy
            if (currentRoute.length > 1) {
                const latlngs = currentRoute.map(point => [point.lat, point.lng]);
                routePolyline = L.polyline(latlngs, {
                    color: '#e74c3c',
                    weight: 4,
                    opacity: 0.8
                }).addTo(map);
                
                // P≈ôidej markery pro zast√°vky
                stops.forEach((stop, index) => {
                    const stopMarker = L.marker([stop.location.lat, stop.location.lng], {
                        icon: L.divIcon({
                            className: 'stop-marker',
                            html: `<div style="background: #f39c12; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold;">${index + 1}</div>`,
                            iconSize: [30, 30]
                        })
                    }).addTo(map)
                    .bindPopup(`üõë Zast√°vka ${index + 1}<br>‚è∞ ${stop.startTime.toLocaleTimeString('cs-CZ')}<br>‚è±Ô∏è ${stop.duration} min`);
                });
            }
        }

        // Spr√°va ulo≈æen√Ωch cest
        function loadSavedTrips() {
            const saved = localStorage.getItem('stazkaTrips');
            if (saved) {
                try {
                    savedTrips = JSON.parse(saved);
                    // P≈ôev√©st timestamp stringy zpƒõt na Date objekty
                    savedTrips.forEach(trip => {
                        if (trip.startTime) trip.startTime = new Date(trip.startTime);
                        if (trip.endTime) trip.endTime = new Date(trip.endTime);
                        if (trip.route) {
                            trip.route.forEach(point => {
                                point.timestamp = new Date(point.timestamp);
                            });
                        }
                        if (trip.stops) {
                            trip.stops.forEach(stop => {
                                stop.startTime = new Date(stop.startTime);
                                if (stop.endTime) stop.endTime = new Date(stop.endTime);
                            });
                        }
                    });
                } catch (e) {
                    savedTrips = [];
                }
            }
        }

        function saveCurrentTrip() {
            if (!currentTripId) return;
            
            const tripIndex = savedTrips.findIndex(t => t.id === currentTripId);
            if (tripIndex >= 0) {
                savedTrips[tripIndex] = {
                    ...savedTrips[tripIndex],
                    route: [...currentRoute],
                    stops: [...stops],
                    lastUpdate: new Date(),
                    isActive: isTracking
                };
                
                localStorage.setItem('stazkaTrips', JSON.stringify(savedTrips));
                updateSavedTripsDisplay();
            }
        }

        function updateSavedTripsDisplay() {
            const container = document.getElementById('savedTripsContainer');
            
            if (savedTrips.length === 0) {
                container.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">≈Ω√°dn√© ulo≈æen√© cesty</div>';
                return;
            }
            
            container.innerHTML = savedTrips.map(trip => `
                <div class="trip-item" onclick="continueTrip('${trip.id}')">
                    <div class="trip-info">
                        <div class="trip-details">
                            <div class="trip-title">${trip.data.driverName} - ${trip.data.vehiclePlate}</div>
                            <div class="trip-meta">
                                üìÖ ${trip.startTime.toLocaleDateString('cs-CZ')} 
                                üïê ${trip.startTime.toLocaleTimeString('cs-CZ')}
                                ${trip.route ? 'üìç ' + trip.route.length + ' bod≈Ø' : ''}
                                ${trip.stops ? 'üõë ' + trip.stops.length + ' zast√°vek' : ''}
                            </div>
                        </div>
                        <div class="trip-status-badge ${trip.isActive ? 'active' : ''}">
                            ${trip.isActive ? 'Aktivn√≠' : 'Ukonƒçen√°'}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function continueTrip(tripId) {
            const trip = savedTrips.find(t => t.id === tripId);
            if (!trip) return;
            
            if (!trip.isActive) {
                alert('‚ö†Ô∏è Tato cesta je ji≈æ ukonƒçen√°.\nNelze v n√≠ pokraƒçovat.');
                return;
            }
            
            if (confirm(`üîÑ Pokraƒçovat v cestƒõ?\n\nüë§ ${trip.data.driverName}\nüöö ${trip.data.vehiclePlate}\nüìÖ ${trip.startTime.toLocaleDateString('cs-CZ')}\n\nAplikace naƒçte ulo≈æenou trasu a bude pokraƒçovat ve sledov√°n√≠.`)) {
                
                // Naƒçti data cesty
                tripData = trip.data;
                currentRoute = trip.route || [];
                stops = trip.stops || [];
                tripStartTime = trip.startTime;
                currentTripId = tripId;
                isTracking = true;
                
                // Aktualizuj UI
                document.getElementById('tripStatus').classList.add('active');
                document.getElementById('tripStartDisplay').textContent = tripStartTime.toLocaleString('cs-CZ');
                document.getElementById('newTripForm').classList.add('hidden');
                
                // Zmƒõ≈à tlaƒç√≠tka
                document.getElementById('startBtn').style.display = 'none';
                document.getElementById('clearBtn').style.display = 'none';
                document.getElementById('stopBtn').style.display = 'block';
                document.getElementById('endBtn').style.display = 'block';
                
                // Spus≈• timer
                if (tripTimer) clearInterval(tripTimer);
                tripTimer = setInterval(updateTripTimer, 1000);
                
                // Aktualizuj mapu
                updateRouteOnMap();
                updateTripStats();
                
                // Zmƒõ≈à title mapy
                document.getElementById('mapTitle').textContent = 'Sledov√°n√≠ trasy';
                
                // Pokud je aktu√°ln√≠ poloha daleko od posledn√≠ho bodu, dopoƒç√≠tej optim√°ln√≠ trasu
                const currentPos = getCurrentPosition();
                if (currentPos && currentRoute.length > 0) {
                    const lastPoint = currentRoute[currentRoute.length - 1];
                    const distance = calculateDistance(
                        currentPos.lat, currentPos.lng,
                        lastPoint.lat, lastPoint.lng
                    );
                    
                    if (distance > 1) { // V√≠ce ne≈æ 1km rozd√≠l
                        if (confirm(`üìç Jste ${distance.toFixed(1)} km od posledn√≠ho bodu trasy.\n\nM√°m dopoƒç√≠tat optim√°ln√≠ trasu mezi body?`)) {
                            interpolateRoute(lastPoint, currentPos);
                        }
                    }
                }
                
                alert('‚úÖ Pokraƒçuji v cestƒõ!\n\nüìç Trasa naƒçtena\nüîÑ Sledov√°n√≠ aktivn√≠');
            }
        }

        function interpolateRoute(fromPoint, toPoint) {
            // Jednoduch√° interpolace - vytvo≈ô√≠ body ka≈æd√Ωch 500m
            const distance = calculateDistance(fromPoint.lat, fromPoint.lng, toPoint.lat, toPoint.lng);
            const steps = Math.max(2, Math.floor(distance * 2)); // Body po 500m
            
            for (let i = 1; i < steps; i++) {
                const ratio = i / steps;
                const interpolatedLat = fromPoint.lat + (toPoint.lat - fromPoint.lat) * ratio;
                const interpolatedLng = fromPoint.lng + (toPoint.lng - fromPoint.lng) * ratio;
                
                currentRoute.push({
                    lat: interpolatedLat,
                    lng: interpolatedLng,
                    timestamp: new Date(fromPoint.timestamp.getTime() + (new Date().getTime() - fromPoint.timestamp.getTime()) * ratio),
                    speed: 0,
                    accuracy: 100,
                    interpolated: true
                });
            }
            
            saveCurrentTrip();
            updateRouteOnMap();
        }

        function startTracking() {
            isTracking = true;
            currentRoute = [];
            stops = [];
            tripStartTime = new Date();
            currentTripId = Date.now().toString();
            
            // Vytvo≈ô novou cestu v √∫lo≈æi≈°ti
            const newTrip = {
                id: currentTripId,
                data: {...tripData},
                startTime: tripStartTime,
                endTime: null,
                route: [],
                stops: [],
                isActive: true,
                lastUpdate: new Date()
            };
            
            savedTrips.push(newTrip);
            saveCurrentTrip();
            updateSavedTripsDisplay();
            
            // UI changes
            document.getElementById('tripStatus').classList.add('active');
            document.getElementById('tripStartDisplay').textContent = tripStartTime.toLocaleString('cs-CZ');
            document.getElementById('newTripForm').classList.add('hidden');
            document.getElementById('mapTitle').textContent = 'Sledov√°n√≠ trasy';
            
            // Show/hide buttons
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('clearBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'block';
            document.getElementById('endBtn').style.display = 'block';
            
            // Start trip timer
            if (tripTimer) clearInterval(tripTimer);
            tripTimer = setInterval(updateTripTimer, 1000);
            
            // Haptic feedback
            if ('vibrate' in navigator) {
                navigator.vibrate(200);
            }
        }

        function addStop() {
            if (!isTracking) return;
            
            const currentPos = getCurrentPosition();
            if (!currentPos) {
                alert('GPS poloha nen√≠ dostupn√°');
                return;
            }
            
            const stopTime = new Date();
            const stop = {
                id: stops.length + 1,
                startTime: stopTime,
                endTime: null,
                location: {
                    lat: currentPos.lat,
                    lng: currentPos.lng,
                    address: `${currentPos.lat.toFixed(6)}, ${currentPos.lng.toFixed(6)}`
                },
                duration: 0
            };
            
            stops.push(stop);
            saveCurrentTrip();
            updateRouteOnMap();
            updateTripStats();
            
            // Change button to resume
            const stopBtn = document.getElementById('stopBtn');
            stopBtn.innerHTML = '<span>‚ñ∂Ô∏è</span>Pokraƒçovat';
            stopBtn.onclick = resumeFromStop;
            
            alert('üõë Zast√°vka zaznamen√°na!');
        }

        function resumeFromStop() {
            if (stops.length > 0) {
                const lastStop = stops[stops.length - 1];
                if (!lastStop.endTime) {
                    lastStop.endTime = new Date();
                    lastStop.duration = Math.round((lastStop.endTime - lastStop.startTime) / 1000 / 60);
                    saveCurrentTrip();
                    updateRouteOnMap();
                }
            }
            
            // Change button back to stop
            const stopBtn = document.getElementById('stopBtn');
            stopBtn.innerHTML = '<span>‚è∏Ô∏è</span>P≈ôidat zast√°vku';
            stopBtn.onclick = addStop;
        }

        function endTrip() {
            if (!isTracking) return;
            
            // Zeptej se na konec cesty
            const currentPos = getCurrentPosition();
            let endLocation = tripData.endLocation || 'Nezn√°m√© m√≠sto';
            
            if (currentPos) {
                const useCurrentLocation = confirm(`üìç Je aktu√°ln√≠ GPS poloha koncem cesty?\n\nAktu√°ln√≠ poloha:\n${currentPos.lat.toFixed(6)}, ${currentPos.lng.toFixed(6)}\n\nKliknƒõte OK pro pou≈æit√≠ aktu√°ln√≠ polohy\nKliknƒõte Zru≈°it pro ruƒçn√≠ zad√°n√≠`);
                
                if (!useCurrentLocation) {
                    endLocation = prompt('üìç Zadejte konec cesty:', endLocation);
                    if (!endLocation) {
                        return; // Zru≈°eno
                    }
                } else {
                    endLocation = `${currentPos.lat.toFixed(6)}, ${currentPos.lng.toFixed(6)}`;
                }
            } else {
                endLocation = prompt('üìç GPS nedostupn√©. Zadejte konec cesty:', endLocation);
                if (!endLocation) {
                    return;
                }
            }
            
            if (confirm(`üèÅ Ukonƒçit j√≠zdu?\n\nüìç Konec cesty: ${endLocation}\n\nBudou vygenerov√°na XML data a odesl√°na na email.`)) {
                isTracking = false;
                
                // Complete any ongoing stop
                if (stops.length > 0) {
                    const lastStop = stops[stops.length - 1];
                    if (!lastStop.endTime) {
                        lastStop.endTime = new Date();
                        lastStop.duration = Math.round((lastStop.endTime - lastStop.startTime) / 1000 / 60);
                    }
                }
                
                // Aktualizuj koneƒçn√© m√≠sto
                tripData.actualEndLocation = endLocation;
                
                generateAndSendXML();
            }
        }

        function getCurrentPosition() {
            const lat = document.getElementById('latitude').textContent;
            const lng = document.getElementById('longitude').textContent;
            
            if (lat === '---' || lng === '---') return null;
            
            return {
                lat: parseFloat(lat),
                lng: parseFloat(lng)
            };
        }

        function updateTripTimer() {
            if (!isTracking || !tripStartTime) return;
            
            const now = new Date();
            const diff = Math.floor((now - tripStartTime) / 1000);
            const hours = Math.floor(diff / 3600);
            const minutes = Math.floor((diff % 3600) / 60);
            
            document.getElementById('tripDuration').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }

        function updateTripStats() {
            if (!isTracking && currentRoute.length === 0) return;
            
            // Calculate distance
            let totalDistance = 0;
            for (let i = 1; i < currentRoute.length; i++) {
                totalDistance += calculateDistance(
                    currentRoute[i-1].lat, currentRoute[i-1].lng,
                    currentRoute[i].lat, currentRoute[i].lng
                );
            }
            
            document.getElementById('tripDistance').textContent = totalDistance.toFixed(1);
            document.getElementById('routePoints').textContent = currentRoute.length;
            document.getElementById('stopsCount').textContent = stops.length;
        }

        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function clearForm() {
            if (confirm('Opravdu chcete vymazat v≈°echny zadan√© √∫daje?')) {
                document.getElementById('mobileLogbookForm').reset();
                initializeApp();
            }
        }

        function generateAndSendXML() {
            const tripEndTime = new Date();
            
            // Ukonƒçi cestu v √∫lo≈æi≈°ti
            const tripIndex = savedTrips.findIndex(t => t.id === currentTripId);
            if (tripIndex >= 0) {
                savedTrips[tripIndex].endTime = tripEndTime;
                savedTrips[tripIndex].isActive = false;
                savedTrips[tripIndex].route = [...currentRoute];
                savedTrips[tripIndex].stops = [...stops];
                localStorage.setItem('stazkaTrips', JSON.stringify(savedTrips));
            }
            
            // Generate XML
            const xmlData = generateTripXML(tripData, currentRoute, stops, tripStartTime, tripEndTime);
            
            // Send email
            sendEmailWithXML(xmlData, tripData);
            
            // Reset UI
            resetAppAfterTrip();
        }

        function generateTripXML(tripData, route, stops, startTime, endTime) {
            const xml = `<?xml version="1.0" encoding="UTF-8"?>
<StazkaData>
    <TripInfo>
        <TripId>${currentTripId}</TripId>
        <StartTime>${startTime.toISOString()}</StartTime>
        <EndTime>${endTime.toISOString()}</EndTime>
        <Duration>${Math.round((endTime - startTime) / 1000 / 60)} minutes</Duration>
    </TripInfo>
    
    <Driver>
        <Name>${tripData.driverName || 'N/A'}</Name>
        <LicenseNumber>${tripData.licenseNumber || 'N/A'}</LicenseNumber>
        <Employer>${tripData.employerName || 'N/A'}</Employer>
    </Driver>
    
    <Vehicle>
        <PlateNumber>${tripData.vehiclePlate || 'N/A'}</PlateNumber>
        <Type>${tripData.vehicleType || 'N/A'}</Type>
        <TrailerPlate>${tripData.trailerPlate || 'N/A'}</TrailerPlate>
        <OdometerStart>${tripData.odometerStart || 0}</OdometerStart>
    </Vehicle>
    
    <Route>
        <StartLocation>${tripData.startLocation || 'N/A'}</StartLocation>
        <PlannedEndLocation>${tripData.endLocation || 'N/A'}</PlannedEndLocation>
        <ActualEndLocation>${tripData.actualEndLocation || 'N/A'}</ActualEndLocation>
        <Description>${tripData.routeDescription || 'N/A'}</Description>
        <TotalDistance>${calculateTotalDistance(route).toFixed(2)} km</TotalDistance>
        <Points>
${route.map(point => `            <Point>
                <Latitude>${point.lat}</Latitude>
                <Longitude>${point.lng}</Longitude>
                <Timestamp>${point.timestamp.toISOString()}</Timestamp>
                <Speed>${((point.speed || 0) * 3.6).toFixed(1)} km/h</Speed>
                <Accuracy>${point.accuracy || 0} m</Accuracy>
                <Interpolated>${point.interpolated || false}</Interpolated>
            </Point>`).join('\n')}
        </Points>
    </Route>
    
    <Stops>
${stops.map(stop => `        <Stop>
            <Id>${stop.id}</Id>
            <StartTime>${stop.startTime.toISOString()}</StartTime>
            <EndTime>${stop.endTime ? stop.endTime.toISOString() : 'N/A'}</EndTime>
            <Duration>${stop.duration} minutes</Duration>
            <Location>
                <Latitude>${stop.location.lat}</Latitude>
                <Longitude>${stop.location.lng}</Longitude>
                <Address>${stop.location.address}</Address>
            </Location>
        </Stop>`).join('\n')}
    </Stops>
    
    <Summary>
        <TotalStops>${stops.length}</TotalStops>
        <TotalRoutePoints>${route.length}</TotalRoutePoints>
        <AverageSpeed>${calculateAverageSpeed(route).toFixed(1)} km/h</AverageSpeed>
        <MaxSpeed>${calculateMaxSpeed(route).toFixed(1)} km/h</MaxSpeed>
        <InterpolatedPoints>${route.filter(p => p.interpolated).length}</InterpolatedPoints>
    </Summary>
</StazkaData>`;
            
            return xml;
        }

        function calculateTotalDistance(route) {
            let total = 0;
            for (let i = 1; i < route.length; i++) {
                total += calculateDistance(
                    route[i-1].lat, route[i-1].lng,
                    route[i].lat, route[i].lng
                );
            }
            return total;
        }

        function calculateAverageSpeed(route) {
            if (route.length === 0) return 0;
            const speeds = route.filter(p => p.speed > 0).map(p => p.speed * 3.6);
            return speeds.length > 0 ? speeds.reduce((a, b) => a + b, 0) / speeds.length : 0;
        }

        function calculateMaxSpeed(route) {
            if (route.length === 0) return 0;
            return Math.max(...route.map(p => (p.speed || 0) * 3.6));
        }

        function sendEmailWithXML(xmlData, tripData) {
            const subject = `Stazka - ${tripData.driverName} - ${new Date().toLocaleDateString('cs-CZ')}`;
            
            const message = `üìß XML DATA PRO EMAIL: zsiska@seznam.cz

üìã P≈òEDMƒöT: ${subject}

üìÑ XML DATA (zkop√≠rujte v≈°e n√≠≈æe):
${xmlData}

üì± STATISTIKY:
‚Ä¢ ≈òidiƒç: ${tripData.driverName}
‚Ä¢ Vozidlo: ${tripData.vehiclePlate}  
‚Ä¢ Datum: ${new Date().toLocaleDateString('cs-CZ')}
‚Ä¢ Doba j√≠zdy: ${document.getElementById('tripDuration').textContent}
‚Ä¢ Vzd√°lenost: ${document.getElementById('tripDistance').textContent} km
‚Ä¢ Zast√°vky: ${stops.length}
‚Ä¢ Konec cesty: ${tripData.actualEndLocation}`;

            const emailBody = encodeURIComponent(`Dobr√Ω den,

zas√≠l√°m XML data z elektronick√© stazky:

≈òidiƒç: ${tripData.driverName}
Vozidlo: ${tripData.vehiclePlate}
Datum: ${new Date().toLocaleDateString('cs-CZ')}
Doba j√≠zdy: ${document.getElementById('tripDuration').textContent}
Ujet√° vzd√°lenost: ${document.getElementById('tripDistance').textContent} km
Poƒçet zast√°vek: ${stops.length}
Konec cesty: ${tripData.actualEndLocation}

XML data:

${xmlData}

S pozdravem,
Elektronick√° stazka`);

            const mailtoLink = `mailto:zsiska@seznam.cz?subject=${encodeURIComponent(subject)}&body=${emailBody}`;
            
            if (confirm('üéâ J√çZDA DOKONƒåENA!\n\nüìß Nyn√≠ se zobraz√≠ XML data pro email.\n\nKliknƒõte OK pro zobrazen√≠ dat k zkop√≠rov√°n√≠.')) {
                
                try {
                    window.open(mailtoLink, '_blank');
                } catch (e) {
                    console.log('Mailto failed');
                }
                
                setTimeout(() => {
                    alert(message);
                }, 500);
                
                console.log('=== STAZKA XML DATA ===');
                console.log(xmlData);
                console.log('=== END XML DATA ===');
                console.log('Email: zsiska@seznam.cz');
                console.log('Subject:', subject);
            }
        }

        function resetAppAfterTrip() {
            // Reset tracking state
            isTracking = false;
            currentRoute = [];
            stops = [];
            tripData = {};
            tripStartTime = null;
            currentTripId = null;
            
            if (tripTimer) {
                clearInterval(tripTimer);
                tripTimer = null;
            }
            
            // Reset UI
            document.getElementById('tripStatus').classList.remove('active');
            document.getElementById('newTripForm').classList.remove('hidden');
            document.getElementById('mapTitle').textContent = 'Aktu√°ln√≠ poloha';
            
            // Reset buttons
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('clearBtn').style.display = 'block';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('endBtn').style.display = 'none';
            
            // Reset stop button
            const stopBtn = document.getElementById('stopBtn');
            stopBtn.innerHTML = '<span>‚è∏Ô∏è</span>P≈ôidat zast√°vku';
            stopBtn.onclick = addStop;
            
            // Clear route from map
            if (routePolyline) {
                map.removeLayer(routePolyline);
                routePolyline = null;
            }
            
            // Update saved trips display
            updateSavedTripsDisplay();
            
            // Clear form
            document.getElementById('mobileLogbookForm').reset();
            initializeApp();
            
            alert('üéâ J√≠zda ukonƒçena!\n\nXML data byla vygenerov√°na a odesl√°na na email zsiska@seznam.cz\n\nCesta byla ulo≈æena do historie.');
        }

        // Obsluha odesl√°n√≠ formul√°≈ôe
        document.getElementById('mobileLogbookForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            tripData = Object.fromEntries(formData);
            
            // P≈ôid√°n√≠ GPS dat
            tripData.startLatitude = document.getElementById('latitude').textContent;
            tripData.startLongitude = document.getElementById('longitude').textContent;
            tripData.gpsAccuracy = document.getElementById('accuracy').textContent;
            
            console.log('√ödaje ze stazky:', tripData);
            
            // Zah√°jen√≠ sledov√°n√≠ trasy
            startTracking();
            
            // Cross-platform haptic feedback
            if ('vibrate' in navigator) {
                navigator.vibrate([100, 50, 100]);
            } else if (window.DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission === 'function') {
                try {
                    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMcBjiR1/LNeSsFJHfH8N2QQAoUXrT
